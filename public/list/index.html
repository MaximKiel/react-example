<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>List</title>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>

<div id="root"></div>

</body>

<script type="text/babel">

    function FilterableProductTable({products}) {

        const [filterText, setFilterText] = React.useState('');
        const [inStockOnly, setInStockOnly] = React.useState(false);

        const filteredProduct = [];

        products.forEach((product) => {
            var canAdd = true;
            if (product.name.toLowerCase().indexOf(filterText.toLowerCase()) === -1) {
                canAdd = false;
            }
            if (inStockOnly && !product.stocked) {
                canAdd = false;
            }
            if (canAdd) {
                filteredProduct.push(product);
            }
        });

        console.log(filteredProduct);

        return (
            <div>
                <SearchBar
                    filterText={filterText}
                    onFilterTextChange={setFilterText}

                    inStockOnly={inStockOnly}
                    onInStockOnlyChange={setInStockOnly}
                />
                <ProductTable products={filteredProduct}/>
            </div>
        );
    }

    function SearchBar({
                           filterText,
                           onFilterTextChange,
                           inStockOnly: inStockOnly,
                           onInStockOnlyChange
                       }) {
        return (
            <>
                <div>
                    <form role="search" id="form">
                        <input type="search"
                               value={filterText}
                               placeholder="Поиск..."
                               onChange={(e) => onFilterTextChange(e.target.checked)}
                        />
                    </form>
                </div>
                
                <div>
                    Показать только в наличии
                    <input type="checkbox" id="box"
                           checked={inStockOnly}
                           onChange={(e) => onInStockOnlyChange(e.target.checked)}
                    />
                </div>
            </>
        );
    }

    function ProductTable({products}) {
        const rows = [];

        let lastCategory = null;

        products.forEach((product) => {
            if (product.category !== lastCategory) {
                rows.push(
                    <ProductCategoryRow
                        category={product.category}
                        key={product.name}
                    />
                );
            }
            rows.push(
                <ProductRow
                    product={product}
                    key={product.name}
                />
            );
            lastCategory = product.category;
        });

        return (
            <div>
                <table>
                    <thread>
                        <tr>
                            <th>Название</th>
                            <th>Цена</th>
                        </tr>
                    </thread>
                    <tbody>{rows}</tbody>
                </table>
            </div>
        );
    }

    function ProductCategoryRow({category}) {
        return (
            <tr>
                <th colSpan="2">
                    {category}
                </th>
            </tr>
        );
    }

    function ProductRow({product}) {
        const name = product.stocked ? product.name :
            <s>
                {product.name}
            </s>;
        return (
            <tr>
                <td>{name}</td>
                <td>{product.price}</td>
            </tr>
        );
    }

    const PRODUCTS = [
        {category: "Фрукты", price: "500", stocked: true, name: "Ананас"},
        {category: "Фрукты", price: "200", stocked: false, name: "Банан"},
        {category: "Фрукты", price: "130", stocked: true, name: "Яблоко"},
        {category: "Фрукты", price: "180", stocked: true, name: "Груша"},
        {category: "Овощи", price: "400", stocked: true, name: "Помидор"},
        {category: "Овощи", price: "240", stocked: true, name: "Огурец"},
        {category: "Овощи", price: "50", stocked: false, name: "Картофель"}
    ];

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FilterableProductTable products={PRODUCTS}/>);

</script>
</html>